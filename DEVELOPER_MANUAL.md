# 開発者向け手順書 (Developer Manual)

このドキュメントは、本プロジェクト（多言語・多拠点Webサイト）の開発フロー、ルール、およびトラブルシューティングについて詳細に記述したものです。

---

## 1. システム構成と基本思想

### 1.1 アーキテクチャ: モノレポ & オーバーレイ
本プロジェクトは単一のリポジトリ（Monorepo）で複数の国のサイトを管理しています。
最大の特徴は **「オーバーレイ（重ね合わせ）ビルド方式」** です。

* **Base Layer (`src/_shared`):** 全世界共通のHTML/SCSS/画像。
* **Overlay Layer (`src/locales/xx`):** 国ごとの差分ファイル。

**ビルド時の挙動:**
1. まず `src/_shared` のファイルをビルド用ディレクトリ（`.tmp` または `dist`）にコピーします。
2. 次に `src/locales/{国コード}` のファイルを **上書きコピー** します。
3. その結果を最終的な成果物として出力します。

> **Point:** 「共通」をベースにしつつ、「個別」で上書きすることで、共通修正の反映漏れを防ぎながらローカライズを実現しています。

---

## 2. 開発環境のセットアップ

### 2.1 必須ツール
* **Node.js:** v18.0.0 以上 (推奨: v20 LTS)
* **npm:** v8.0.0 以上
* **Git:** 最新版

### 2.2 初回セットアップ手順
ターミナルでプロジェクトルートに移動し、以下を実行してください。

```bash
# 依存パッケージのインストール
npm install
```

---

## 3. 日々の開発フロー

### 3.1 開発サーバーの起動 (Watchモード)
作業する対象の国に合わせてコマンドを実行してください。ファイルの変更を検知して自動的にコンパイルされます。

* **日本版 (JP) の作業:**
  ```bash
  npm run dev:jp
  ```
* **米国版 (US) の作業:**
  ```bash
  npm run dev:us
  ```

※ 実行中はターミナルを閉じないでください。終了するには `Ctrl + C` を押します。

### 3.2 ファイルの編集ルール

#### ケースA: 全世界共通のデザイン・文言を修正したい
* **編集場所:** `src/_shared/` 配下のファイル
* **影響範囲:** すべての国のサイトに変更が反映されます。
* **注意点:** 修正後、必ずJPとUS両方の画面で崩れがないか確認してください。

#### ケースB: 日本サイトだけデザイン・画像を変えたい
* **編集場所:** `src/locales/jp/` 配下のファイル
* **手順:**
    1. `src/_shared` にある変更したいファイルと同じパス・ファイル名で、`src/locales/jp` にファイルを作成します。
    2. そのファイルの内容が、ビルド時に優先（上書き）されます。

    > **例: ロゴ画像の差し替え**
    > * 共通: `src/_shared/img/logo.svg`
    > * 日本: `src/locales/jp/img/logo.svg` ← これを作成して配置

#### ケースC: 日本サイト独自のスタイルを追加したい
* **編集場所:** `src/locales/jp/scss/` 配下
* **手順:**
    1. `style.scss` などのエントリーポイントではなく、パーシャルファイル（例: `object/project/_campaign.scss`）を作成します。
    2. 必要であれば `_variables.scss` で変数を上書きします。

---

## 4. SCSSとHTMLの取り扱い詳細

### 4.1 SCSSディレクトリ構成 (FLOCSS)
本プロジェクトは FLOCSS 設計を採用しています。

* **Foundation:** リセット、変数、Mixin (`src/_shared/scss/foundation/`)
* **Layout:** ヘッダー、フッターなどの共通枠 (`src/_shared/scss/layout/`)
* **Object:**
    * **Component:** 再利用可能な最小単位。マージンを持たない (`src/_shared/scss/object/component/`)
    * **Project:** コンテンツの集合体。具体的なレイアウト (`src/_shared/scss/object/project/`)
    * **Utility:** 調整用クラス (`src/_shared/scss/object/utility/`)

### 4.2 変数 (`_variables.scss`) の注意点
国ごとにテーマカラーやフォントを変えるため、`_variables.scss` は **オーバーレイの対象** になっています。

* **JPの設定を変更する場合:**
  `src/locales/jp/scss/foundation/_variables.scss` を編集します。
  **重要:** このファイルには、共通設定を継承する仕組みがないため、**必要な変数はすべて（共通と同じ値であっても）定義する必要があります。**

---

## 5. デプロイ・納品用データの作成

本番環境へのデプロイや納品用データを作成する場合は、以下のコマンドを実行します。

```bash
# 全ての国のデータをビルド
npm run build:all
```

**出力先:**
* 日本向け: `dist/jp/`
* 米国向け: `dist/us/`

※ この `dist` フォルダの中身をWebサーバーにアップロードしてください。

---

## 6. トラブルシューティング

### Q1. SCSSを修正したのに反映されない
* **確認:** `npm run dev:jp` (またはus) は起動していますか？
* **確認:** エラーログが出ていませんか？ ターミナルを確認してください。
* **確認:** `src/_shared` を編集しているつもりで、実は `src/locales/jp` 側に同名ファイルがあり、そちらが優先されていませんか？

### Q2. 新しいSCSSファイルを作ったらエラーになった
* **原因:** `@use` または `@import` の記述忘れの可能性があります。
* **対応:** `style.scss` (エントリーポイント) に、新しく作ったファイルの読み込み記述を追加してください。

### Q3. "Error: ENOENT: no such file or directory" が出る
* **原因:** ビルドスクリプトで使用しているディレクトリが存在しない可能性があります。
* **対応:** 一度 `npm run clean` を実行してから、再度コマンドを試してください。

### Q4. 共通の変数を追加したら、JPビルドだけエラーになった
* **原因:** JP側の `src/locales/jp/scss/foundation/_variables.scss` にその変数が定義されていないためです。
* **対応:** 共通 (`_shared`) に変数を追加した際は、必ず各国の `_variables.scss` にも同じ変数を追記してください。

---

## 7. Gitコミット・ブランチ運用

* **ブランチ:**
    * `main`: 本番用安定版
    * `develop`: 開発用
    * `feature/...`: 機能追加用
* **コミットメッセージ:**
    * `feat`: 機能追加
    * `fix`: バグ修正
    * `style`: デザイン調整
    * `docs`: ドキュメント修正

---

_Document Version: 1.0.0_
_Last Updated: 2025-12-09_
