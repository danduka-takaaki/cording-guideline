# コーディングガイドライン & 開発マニュアル

## 1. 開発環境のセットアップ

### 前提条件
* Node.js v18以上 (推奨: v20 LTS)
* npm 8以上

### インストール
リポジトリをクローンした後、以下のコマンドで依存パッケージをインストールしてください。

```bash
npm install
```

### 開発コマンド
開発時は以下のコマンドを使用します。ファイルの変更を検知して自動的にビルド（コンパイル）が実行されます。

* **日本版サイト (JP) の開発:**
  ```bash
  npm run dev:jp
  ```
  実行すると `dist/jp/` にファイルが出力されます。

* **米国版サイト (US) の開発:**
  ```bash
  npm run dev:us
  ```

### 本番ビルド
デプロイ用のアセットを生成する場合は以下のコマンドを実行します（圧縮・最適化されます）。

```bash
npm run build:all
```

---

## 2. ディレクトリ運用ルール (重要)

本プロジェクトは **「共通資材 (_shared)」** をベースに、**「国別資材 (locales)」** を上書き（Overlay）してビルドする特殊な構成です。

### 基本原則
1. **新規作成・修正は原則 `_shared` で行う**
   全サイト共通で使うファイルは必ず `src/_shared` 配下を編集してください。

2. **国別の差分対応**
   「日本だけ画像を変えたい」「USだけ文字サイズを変えたい」場合のみ、`src/locales/{国コード}` 配下に **同名ファイル** を作成して配置します。
   * 例: 日本だけロゴを変える場合
     * 共通: `src/_shared/img/logo.svg`
     * 日本: `src/locales/jp/img/logo.svg` (これを置くと、ビルド時に日本版だけ上書きされます)

### SCSS変数の上書きについて
`_variables.scss` を国別ディレクトリに置くことで、サイトごとのテーマカラーやフォントを切り替えています。
* **注意:** 国別の `_variables.scss` を作成する場合、共通設定は継承されません。**必要な変数はすべて定義し直す必要があります。**

---

## 3. はじめに

### 3.1 目的
本ガイドラインは、プロジェクトにおけるコードの品質、保守性、拡張性を担保することを目的とする。
複数人での開発において、コードのバラつきを防ぎ、誰が書いても予測可能で読みやすいコード状態を維持する。

### 3.2 対象範囲
* HTML / CSS (Sass) / JavaScript
* 画像・アセット管理
* ディレクトリ構成・命名規則

---

## 4. 全体共通ルール

### 4.1 文字コード・改行コード
* **文字コード:** `UTF-8` (BOMなし)
* **改行コード:** `LF` (UNIX標準)
* **インデント:** スペース2つ (Soft Tabs: 2)
* **末尾の空白:** 行末の不要なスペースは削除する。ファイルの末尾は空行を1つ入れる。

### 4.2 ファイル・ディレクトリ命名規則
* すべて **小文字 (lower case)** を使用する。
* 単語の区切りには **ハイフン (kebab-case)** を使用する（画像ファイル含む）。
    * Good: `company-logo.svg`, `main-visual.jpg`
    * Bad: `company_logo.svg`, `mainVisual.jpg`

---

## 5. HTMLガイドライン

### 5.1 基本原則
* **セマンティックなマークアップ:** 見た目ではなく文書構造に基づいてタグを選択する。
    * 見出しには `h1`〜`h6` を順序通りに使用する。
    * レイアウト目的で `br` タグを使用しない。
    * ボタン機能を持つ要素は `div` や `a` ではなく `<button>` を使用する（ページ遷移を除く）。

### 5.2 アクセシビリティ (a11y)
* **画像:** `img` タグには必ず `alt` 属性を記述する。装飾目的の画像は `alt=""`（空）とする。
* **フォーム:** フォーム部品には必ずラベル (`label`) を関連付ける。

### 5.3 属性の記述順序
可読性を高めるため、以下の順序で記述することを推奨する。

1. `class`
2. `id`, `name`
3. `data-*`
4. `src`, `for`, `type`, `href`
5. `title`, `alt`
6. `aria-*`, `role`

```html
<a class="c-button" id="submitBtn" href="/contact" aria-label="お問い合わせ">
  ...
</a>
```

### 5.4 コメント
主要なブロックの閉じタグには、対応するクラス名や役割をコメントとして記述する。

```html
<header class="l-header">
  ...
</header>
```

---

## 6. CSSガイドライン

### 6.1 設計手法・命名規則
* **設計手法:** **FLOCSS (Foundation Layout Object CSS)** を採用する。
* **命名規則:** **BEM (Block Element Modifier)** を用いる。
    * クラス名は `Block__Element--Modifier` の形式とする。
    * **Elementの連結禁止:** `Block__Element__Element` は不可。常にBlockを起点にする。

### 6.2 ディレクトリ構成 (SCSS)
`style.scss` をエントリーポイントとし、`@use` または `@import` で集約する。

```text
scss/
├── style.scss
├── foundation/  (Reset, Variable, Mixin)
├── layout/      (Header, Footer, Sidebar, Main)
└── object/
    ├── component/ (Button, Icon, Input)
    ├── project/   (Article, Card, Contact)
    └── utility/   (Margin, Text-align)
```

### 6.3 プレフィックス
各レイヤーに対応したプレフィックスを必ず付与する。

| レイヤー | プレフィックス | 役割 | ルール |
| :--- | :--- | :--- | :--- |
| **Foundation** | なし | Reset CSS, 基本スタイル | 具体的なモジュールの定義は禁止 |
| **Layout** | `l-` | ヘッダー、メインエリア等の「枠」 | ページ共通の大きな枠組みに使用 |
| **Component** | `c-` | ボタン、アイコン等の「部品」 | **固有の幅(width)や余白(margin)を持たせない** |
| **Project** | `p-` | 記事一覧、カード等の「コンテンツ」 | Componentを内包しても良い |
| **Utility** | `u-` | `display: none`等の単機能 | `!important` の使用を許容する唯一の場所 |

### 6.4 特別なプレフィックス
* **状態変化 (`is-`):** JavaScriptによる操作や状態変化を表す（例: `.is-active`）。
    * 必ずモジュールとセットで定義する（`is-` クラス単体にはスタイルを当てない）。
* **JSフック (`js-`):** JavaScriptから要素を取得するためだけに使用する。
    * **スタイルを絶対に当ててはいけない**。

### 6.5 禁止事項（アンチパターン）
1. **IDセレクタの使用禁止:** 詳細度が高すぎるため、スタイル目的での `#header` 等の使用は禁止。
2. **要素セレクタへの直接指定の制限:** `div`, `span` などへの直接指定は `foundation` 以外では原則禁止。
3. **マジックナンバーの使用禁止:** 根拠のない `z-index: 9999` や `margin: 37px` などは避ける。

---

## 7. JavaScriptガイドライン

### 7.1 基本構文
* **ES6+ (ES2015以降)** の構文を使用する。
* 変数宣言には `const` を基本とし、再代入が必要な場合のみ `let` を使用する (`var` は禁止)。
* 文字列結合にはテンプレートリテラル (`` `...${val}...` ``) を使用する。

### 7.2 命名規則
* **変数名・関数名:** キャメルケース (camelCase)
    * 例: `userInfo`, `getUserData()`
* **定数:** アッパースネークケース (UPPER_SNAKE_CASE)
    * 例: `API_BASE_URL`, `MAX_WIDTH`
* **クラス名:** パスカルケース (PascalCase)
    * 例: `UserSlider`

### 7.3 DOM操作の分離
* HTML要素をJavaScriptで取得する場合は、原則として `js-` プレフィックスがついたクラス、または `id` 属性を使用する。
* スタイル用のクラス（`p-card` や `c-button`）をJSのセレクタとして使用しないこと（デザイン変更時にJSが壊れるのを防ぐため）。

```javascript
/* Bad */
const btn = document.querySelector('.c-button');

/* Good */
const btn = document.querySelector('.js-submit-button');
```

---

## 8. 画像・アセットガイドライン

### 8.1 推奨フォーマット
* **写真・複雑な画像:** WebP (フォールバックとしてJPG/PNG)
* **アイコン・ロゴ・図版:** SVG

### 8.2 最適化
* 画像はアップロードまたはコミットする前に、TinyPNG等のツールを用いて圧縮を行う。
* `width` / `height` 属性をHTML側で指定し、レイアウトシフト (CLS) を防ぐ。

---

## 9. Git運用・その他

### 9.1 コミットメッセージ
変更内容がひと目でわかるプレフィックスを付けることを推奨する。

* `feat`: 新機能追加
* `fix`: バグ修正
* `update`: 機能修正（バグではない）
* `style`: スタイル調整（見た目の変更のみ）
* `refactor`: リファクタリング
* `docs`: ドキュメント修正

### 9.2 ブランチ運用
* 原則として `main` (または `master`) ブランチへの直接コミットは禁止。
* 作業ごとにトピックブランチを作成し、Pull Request (Merge Request) を通じてマージする。
